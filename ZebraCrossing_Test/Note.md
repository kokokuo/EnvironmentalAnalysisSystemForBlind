# 開發日誌

## 04/13
要推算出一條與偵測的直線垂直的線段方程式
使用斜率不適合

是某偵測出直線後，對直線做映射把圖像轉成正的?(待考慮)
http://docs.opencv.org/doc/tutorials/imgproc/imgtrans/warp_affine/warp_affine.html#warp-affine

---

## 04/14
讓斷掉的線段可以不出線的方式

模糊 -> Mask -> 去雜訊 -> 膨脹，讓線段比較平穩

判斷線段的長度佔畫面地的比例，如果越長是否代表是斑馬線的機會越高(越靠近斑馬線)?

立維提到可以做的 scanline 方法，把許多直線曲中心點，兩兩中心連成線段方程式，在取線段的中心點(or scan 下去)，去取得整個 scanline 像素的顏色

---

## 05/06
分析縮小個解析度的情況，位於以下三種會是不錯的解析度：
1. 400 * 300
2. 440 * 330
3. 480 * 360 (最好)

另外前處理部分，如果要使用：

1. 要使用灰階不使用 Mask 白色，會建議對灰階做模糊，如果是般馬線，模糊後的邊緣顏色差異仍會存在，所以仍然可以找到線條，並過濾不必要的失誤
2. 需要 MASK

則會建議以下兩種方案，並選其一(效果差異還好)，可以過濾掉不必要的 Mask 雜訊
1. 灰階 -> Mask ->Filter Pepper
2. 灰階模糊 -> Mask

### Next
1. 把連線的部分，任何方位的都考慮進去完成連線並統計主流線段

---

## 05/07
把連線的部分，任何方位的都考慮進去完成連線
目前有 Bug 會誤連，原因在於有些線段的角度是負的有些是正的，但是兩個都取絕對值鄉不是是個正確的方式

### Next
1. Fix 連線 Bug
2. 統計主流線段

---

## 05/08
Hough Line 的角度如下

```bash
		   |
-179 ~ -90	   |
		   |
180		--------------
		   |
 179 ~ 90	   |
		   |
```

所以負的角度要換算成正的角度 360 + (-xxx)
並去把換算後的角度相減抓覺得值到誤差
另外面積公式時因為可能另一條線段剛好有一點比較接近目前這條線段，造成會誤判
所以改成另一條細段的兩個點都算，所以有兩個面積公式 並一起判斷

---

## 05/12

Hough line 
threshold : 110 -> 100
Max gap : 30 -> 20

---

## 05/13
1. 修改分類線段方方法：加入判斷線段的方向
2. 加入取得線段的中心點周圍像素來看有無白黑白(尚未判斷)

### Next
1. 顯示取得像素的值與座最終判斷
2. 寫 Paper

## 05/14
1. 顯示像素的曲線圖
2. 檢查每一條線段的周圍像素值，連續兩個黑與連續兩個白即是
3. 找出最長的線段 打算過濾短的線段
4. 修改尋找線段周圍像素前的線段排序方式(加入判斷角度,檢查主方向的線段是哪種角度內，接近90度的線段用x軸排序線段順序)

### Next
1. 寫 Paper
2. 過濾短的線段與最終判斷

---

## 06/03
1. 修改取得周圍像素連線方式，為原先的找出Scanline並檢查Line上經過的pixel,是否為白與黑交錯,黑或白連續幾個點就代表是黑或白
2. 過濾線段
3. 最終判斷

## 06/04
重構開始